(function(){"use strict";var e={7505:function(e,t,n){var o=n(5688),i=(n(4114),n(8992),n(4520),n(782)),a=(0,i.y$)({state:{client:null,connections:[],datas:{},deviceList:{},currentdevice:{}},mutations:{SET_CLIENT(e,t){e.client=t},ADD_CONNECTION(e,t){e.connections.push(t)},REMOVE_CONNECTION(e,t){e.connections=e.connections.filter((e=>e.ip!==t.ip||e.port!==t.port))},SET_DEVICES(e,{key:t,devices:n}){e.deviceList[t]=n},SET_CURRENTDEVICE(e,{key:t,data:n}){e.currentdevice[t]=n},ADD_DATAPACKET(e,{key:t,data:n}){e.datas[t]||(e.datas[t]=[]),e.datas[t].length>=30&&e.datas[t].shift(),e.datas[t].push(n)},REMOVE_DEVICES(e,t){e.currentdevice[t]=null}},actions:{async initConnect({commit:e}){const t=new WebSocket("/ws/capture/");t.onopen=()=>{console.log("WebSocket connection established."),e("SET_CLIENT",t)},t.onmessage=t=>{const n=JSON.parse(t.data);switch(console.log("Received from server:",n),n.status){case"datapacket":{const t=JSON.parse(n.packet),o=n.ip||"unknown";e("ADD_DATAPACKET",{key:o,data:t});break}case"devicelist":{const t=JSON.parse(n.device);e("SET_DEVICES",{key:n.ip,devices:t});break}case"success":console.log("Operation success:",n.message);break;case"successconnect":console.log("Connect ok",n.message);break;case"failconnected":console.log("Connection failed:",n),e("REMOVE_CONNECTION",{ip:n.ip,port:n.port});break;case"getstatus":console.log("Monitor device:",n.device),e("SET_CURRENTDEVICE",{key:n.ip,data:n.device});break;case"stopdevice":e("REMOVE_DEVICES",n.ip),console.log("Stop monitor device");break;default:console.error("Unknown status received:",n.status)}},t.onerror=e=>{console.error("WebSocket error:",e)},t.onclose=()=>{console.log("WebSocket connection closed."),e("SET_CLIENT",null)}},async connectRemoteServer({state:e,commit:t},n){const{client:o}=e;if(!o||o.readyState!==WebSocket.OPEN)return void console.error("WebSocket is not connected.");const{ip:i,port:a}=n,s={command:"connect",ip:i,port:a};o.send(JSON.stringify(s)),t("ADD_CONNECTION",s),console.log(`Sent connect request: ${JSON.stringify(s)}`)},async changeDevice({state:e,commit:t},{device:n,target:o}){const{client:i,deviceList:a}=e;if(!i||i.readyState!==WebSocket.OPEN)return void console.error("WebSocket is not connected.");if(!a[o.ip].includes(n))return void console.error("Invalid device:",n);const s={command:"send_command",action:"switch_device",device:n,ip:o.ip,port:o.port};i.send(JSON.stringify(s)),t("SET_CURRENTDEVICE",{key:o.ip,data:n}),console.log(`Sent switch device request: ${JSON.stringify(s)}`)},async stopCapture({state:e},t){const{client:n}=e;if(!n||n.readyState!==WebSocket.OPEN)return void console.error("WebSocket is not connected.");const o={command:"send_command",action:"stop",ip:t.ip,port:t.port};n.send(JSON.stringify(o)),console.log("Sent stop capture request.")},async getDevices({state:e,commit:t},n){const{client:o}=e;if(!o||o.readyState!==WebSocket.OPEN)return void console.error("WebSocket is not connected.");const i={command:"send_command",action:"list_devices",ip:n.ip,port:n.port};o.send(JSON.stringify(i)),console.log("Sent list devices request.")},async getRemoteStatus({state:e},t){const{client:n}=e;if(!n||n.readyState!==WebSocket.OPEN)return void console.error("WebSocket is not connected.");const o={command:"send_command",action:"status",ip:t.ip,port:t.port};n.send(JSON.stringify(o)),console.log("send status")}}}),s=n(1387),r=n(6768),c=n(5187);const l=e=>((0,r.Qi)("data-v-8ca41320"),e=e(),(0,r.jt)(),e),p={style:{"margin-top":"20px"}},d=l((()=>(0,r.Lk)("h3",null,"Connected Servers",-1))),u={style:{display:"flex","flex-wrap":"wrap",gap:"10px"}},v=["onClick"];function y(e,t,n,o,i,a){const s=(0,r.g2)("a-input"),l=(0,r.g2)("a-form-item"),y=(0,r.g2)("a-input-number"),m=(0,r.g2)("a-button"),f=(0,r.g2)("a-form"),h=(0,r.g2)("a-card");return(0,r.uX)(),(0,r.CE)("div",null,[(0,r.bF)(f,{model:e.formState,name:"connect_form",layout:"inline",autocomplete:"off",onFinish:e.onSubmit,onFinishFailed:e.onFinishFailed},{default:(0,r.k6)((()=>[(0,r.bF)(l,{label:"IP Address",name:"ip",rules:[{required:!0,message:"Please input the IP address!"}]},{default:(0,r.k6)((()=>[(0,r.bF)(s,{value:e.formState.ip,"onUpdate:value":t[0]||(t[0]=t=>e.formState.ip=t),placeholder:"Enter IP"},null,8,["value"])])),_:1}),(0,r.bF)(l,{label:"Port",name:"port",rules:[{required:!0,message:"Please input the port!"}]},{default:(0,r.k6)((()=>[(0,r.bF)(y,{value:e.formState.port,"onUpdate:value":t[1]||(t[1]=t=>e.formState.port=t),min:1,max:65535,placeholder:"Enter Port"},null,8,["value"])])),_:1}),(0,r.bF)(l,null,{default:(0,r.k6)((()=>[(0,r.bF)(m,{type:"primary","html-type":"submit"},{default:(0,r.k6)((()=>[(0,r.eW)(" Connect ")])),_:1})])),_:1})])),_:1},8,["model","onFinish","onFinishFailed"]),(0,r.Lk)("div",p,[d,(0,r.Lk)("div",u,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.connections,((t,n)=>((0,r.uX)(),(0,r.Wv)(h,{key:n,title:"Connection "+(n+1),size:"small",style:{width:"300px"}},{extra:(0,r.k6)((()=>[(0,r.Lk)("a",{onClick:n=>e.navigateTo(t)},"Details",8,v)])),default:(0,r.k6)((()=>[(0,r.Lk)("p",null,"IP: "+(0,c.v_)(t.ip),1),(0,r.Lk)("p",null,"Port: "+(0,c.v_)(t.port),1)])),_:2},1032,["title"])))),128))])])])}var m=n(1798),f=(0,r.pM)({name:"ConnectVue",setup(){const e=(0,i.Pj)(),t=(0,s.rd)(),n=(0,m.Kh)({ip:"127.0.0.1",port:9999}),o=async t=>{t.ip&&t.port?await e.dispatch("connectRemoteServer",t):console.error("Missing IP or Port!")},a=e=>{console.error("Validation Failed:",e)},c=e=>{t.push({name:"Details",params:{ip:e.ip,port:e.port}})};return(0,r.sV)((()=>{e.dispatch("initConnect")})),{formState:n,onSubmit:o,onFinishFailed:a,navigateTo:c}},computed:{...(0,i.aH)(["connections"])},methods:{...(0,i.i0)(["connectRemoteServer","initConnect"])}}),h=n(1241);const S=(0,h.A)(f,[["render",y],["__scopeId","data-v-8ca41320"]]);var k=S;const g=e=>((0,r.Qi)("data-v-7b75453e"),e=e(),(0,r.jt)(),e),E={id:"details"},b=g((()=>(0,r.Lk)("div",{id:"map-container"},[(0,r.Lk)("canvas",{id:"threeCanvas"})],-1))),w={id:"info-container"},_=g((()=>(0,r.Lk)("h3",null,"IP Descriptions",-1))),C={id:"flow-info"},I=g((()=>(0,r.Lk)("h3",null,"Traffic Flow",-1)));function O(e,t,n,o,i,a){const s=(0,r.g2)("a-table");return(0,r.uX)(),(0,r.CE)("div",E,[b,(0,r.Lk)("div",w,[_,o.ipDescriptions.length>0?((0,r.uX)(),(0,r.Wv)(s,{key:0,columns:o.columns,"data-source":o.ipDescriptions,rowKey:"ip",pagination:{pageSize:5}},null,8,["columns","data-source"])):(0,r.Q3)("",!0)]),o.tooltipVisible?((0,r.uX)(),(0,r.CE)("div",{key:0,id:"tooltip",style:(0,c.Tr)(o.tooltipStyle)},(0,c.v_)(o.tooltipText),5)):(0,r.Q3)("",!0),(0,r.Lk)("div",C,[I,(0,r.Lk)("ul",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.trafficData,((e,t)=>((0,r.uX)(),(0,r.CE)("li",{key:t},(0,c.v_)(e),1)))),128))])])])}n(3949);var N=n(8776),P={name:"App",setup(){const e=(0,s.lq)(),t=(0,i.Pj)(),n=(0,m.IJ)(new N.Z58),o=(0,m.IJ)(null),a=(0,m.IJ)(null),c=[],l=(0,m.KR)(null),p=(0,m.KR)([]),d=(0,m.KR)([]),u=(0,m.KR)(!1),v=(0,m.KR)(""),y=(0,m.KR)({}),f=new N.I9Y,h=new N.tBo;let S=!1,k={x:0,y:0},g=!0;const E=[{title:"IP Address",dataIndex:"ip",key:"ip"},{title:"Type",dataIndex:"type",key:"type"},{title:"Description",dataIndex:"description",key:"description"},{title:"ISP",dataIndex:"isp",key:"isp"},{title:"Payload",dataIndex:"payload",key:"payload"}],b=()=>{const e=document.getElementById("threeCanvas");a.value=new N.JeP({canvas:e}),a.value.setSize(window.innerWidth,window.innerHeight),a.value.setPixelRatio(window.devicePixelRatio),o.value=new N.ubm(75,window.innerWidth/window.innerHeight,.1,1e3),o.value.position.z=3;const t=new N.eaF(new N.Gu$(1,64,64),new N._4j({map:(new N.Tap).load("/static/dist/earth.jpg")}));n.value.add(new N.$p8(16777215,.5)),n.value.add(new N.HiM(16777215,.8)),n.value.add(t),l.value=t,e.addEventListener("mousedown",(e=>{S=!0,g=!1,k={x:e.clientX,y:e.clientY}})),e.addEventListener("mousemove",(e=>{if(S){const n=e.clientX-k.x,o=e.clientY-k.y;t.rotation.y+=.005*n,t.rotation.x+=.005*o,k={x:e.clientX,y:e.clientY}}f.x=e.clientX/window.innerWidth*2-1,f.y=-e.clientY/window.innerHeight*2+1,h.setFromCamera(f,o.value);const n=h.intersectObjects(c);n.length>0?(v.value=n[0].object.userData.description,y.value={left:`${e.clientX+10}px`,top:`${e.clientY+10}px`},u.value=!0):u.value=!1})),e.addEventListener("mouseup",(()=>{S=!1,g=!0}));const i=(e,n,o)=>{const i=new N.Pq0(-Math.sin((90-e)*(Math.PI/180))*Math.cos((n+180)*(Math.PI/180)),Math.cos((90-e)*(Math.PI/180)),Math.sin((90-e)*(Math.PI/180))*Math.sin((n+180)*(Math.PI/180))),a=new N.eaF(new N.Gu$(.02,16,16),new N.V9B({color:16711680}));a.position.copy(i.multiplyScalar(1.05)),a.userData.description=o,c.push(a),t.add(a)};return i},w=n=>{c.forEach((e=>l.value.remove(e))),c.length=0,p.value=[];const{ip:o}=e.params,i=t.state.datas[o]||[];i.forEach((e=>{e.lat?(n(e.lat,e.lon,`${e.city}, ${e.region}, ${e.country}, ${e.type}, ${e.ip_src}`),p.value.push({ip:e.ip_src,type:e.type,description:`${e.city}, ${e.region}, ${e.country}`,isp:e.isp,payload:e.payload||"N/A"}),d.value.push(`IP ${e.ip_src}: ${e.type}`)):"DNS"===e.type?p.value.push({ip:e.ip_src,type:e.type,description:`${JSON.stringify(e.protocol_details)}`,isp:e.type,payload:e.payload||"N/A"}):e.ip_src?p.value.push({ip:e.ip_src,type:e.type,description:`${e.ip_src}`,isp:e.type,payload:e.payload||"N/A"}):e.protocol_details&&p.value.push({ip:e.type,type:e.type,description:`${JSON.stringify(e.protocol_details)}`,isp:e.type,payload:e.payload||"N/A"})}))};let _;return(0,r.sV)((()=>{_=b(),w(_);const e=()=>{requestAnimationFrame(e),g&&(l.value.rotation.y+=.002),a.value.render(n.value,o.value)};e()})),(0,r.wB)((()=>t.state.datas),(()=>{w(_)}),{deep:!0}),{ipDescriptions:p,tooltipVisible:u,tooltipText:v,tooltipStyle:y,columns:E,trafficData:d}}};const T=(0,h.A)(P,[["render",O],["__scopeId","data-v-7b75453e"]]);var D=T;const x=[{path:"/",name:"Home",component:k},{path:"/details/:ip/:port",name:"Details",component:D}],F=(0,s.aE)({history:(0,s.Bt)(),routes:x,mode:"hash"});var R=F,A=n(8330);n(4529);function L(e,t,n,o,i,a){const s=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.CE)("div",null,[(0,r.bF)(s)])}var M={name:"Index"};const $=(0,h.A)(M,[["render",L]]);var W=$;const V=(0,o.Ef)(W);V.use(a),V.use(R),V.use(A.Ay),V.mount("#app")}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,n),a.exports}n.m=e,function(){var e=[];n.O=function(t,o,i,a){if(!o){var s=1/0;for(p=0;p<e.length;p++){o=e[p][0],i=e[p][1],a=e[p][2];for(var r=!0,c=0;c<o.length;c++)(!1&a||s>=a)&&Object.keys(n.O).every((function(e){return n.O[e](o[c])}))?o.splice(c--,1):(r=!1,a<s&&(s=a));if(r){e.splice(p--,1);var l=i();void 0!==l&&(t=l)}}return t}a=a||0;for(var p=e.length;p>0&&e[p-1][2]>a;p--)e[p]=e[p-1];e[p]=[o,i,a]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,o){var i,a,s=o[0],r=o[1],c=o[2],l=0;if(s.some((function(t){return 0!==e[t]}))){for(i in r)n.o(r,i)&&(n.m[i]=r[i]);if(c)var p=c(n)}for(t&&t(o);l<s.length;l++)a=s[l],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(p)},o=self["webpackChunktalktives"]=self["webpackChunktalktives"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[504],(function(){return n(7505)}));o=n.O(o)})();
//# sourceMappingURL=app.35aa7978.js.map